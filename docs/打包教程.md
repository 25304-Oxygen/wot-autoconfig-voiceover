# 适配插件的语音包文件制作教程

## 1、前言：

插件本质上是为已成功加载进游戏中的语音包进行注册，以便后续切换与使用。
为了便于读取、安装与卸载，语音包作者需要将语音包制作为特定格式的`.wotmod`文件。
有关WOTMOD文件的介绍可以查阅[文档](Mod文件介绍.md)。

## 2、标准的语音包文件：

必须项：

- 以`voiceover_`开头的`.wotmod`文件；
- 在**任意位置**包含一个特定格式的`json`文件用于识别与读取；
- 语音包中的`.bnk`文件位于`/res/audioww/`中的子文件夹中。

其中：

- `voiceover_`前缀用于识别是否是插件要读取的`.wotmod`文件；
- `json`文件用于在识别后读取，插件将根据保存的信息注册语音包。
- 语音包文件不能直接放在`/res/audioww/`路径目录中，需要位于该目录中的子文件夹中。
这样做是为了尽可能避免两个语音包的`.bnk`文件因为选择的路径相同，从而引发冲突，
导致其中一个语音包被卸载的情况。若语音包路径为`/res/audioww/voiceover.bnk`，
插件将不予理会。
- **文件夹和路径**请尽量使用英文名称。

目前支持的`json`文件以`vo_`或`sbt_`为前缀，你可以在[resources](../resources/template)目录中找到模板文件。
其中`vo_`用于为普通语音包添加可读取信息，`sbt_`为使用字幕的语音包添加可读取信息。

这些信息将用于语音包可选选项的创建和语音包的注册，与`main_sound_modes.xml`的功能相同。

### 2.1 普通语音包文件示例：

将要创建的语音包文件：`voiceover_我的语音包.wotmod`

#### 创建目录

```chatinput
res/
    audioww/
        wo de yu yin bao/
            voiceover.bnk
            inbattle_communication_pc.bnk
            inbattle_communication_npc.bnk
vo_我的语音包信息.json
```

#### `json`文件内容

```json
{
    "nickName": "这是语音包的名字",
    "bankPath": "wo de yu yin bao/voiceover.bnk"
}
```

#### 或者改为这样

```json
[
    {
        "nickName": "这是语音包的名字",
        "bankPath": "wo de yu yin bao/voiceover.bnk"
    }
]
```

其中：

- `nickName`是语音包显示在插件或设置菜单下拉列表的名称
- `bankPath`是从`audioww`出发、指向`voiceover.bnk`文件的相对路径

同时选中`res`目录和`json`（本示例中的`json`与`res`目录位于同级）创建为一个ZIP压缩包，
压缩级别设置为`0`，即`无压缩`。有些压缩软件将其简化为“压缩格式”选项，该选项选择`存储`。
为文件名添加`voiceove_`前缀，最后，将`.zip`后缀修改为`.wotmod`即完成语音包文件制作。

### 2.2 在普通语音包文件中添加多个语音包：

如果需要在一个语音包文件中**添加多个语音包**，目录创建`json`创建参考如下示例：

将要创建的语音包文件：`voiceover_很多语音包.wotmod`

#### 创建目录

```chatinput
res/
    audioww/
        yu yin bao1/
            voiceover.bnk
            inbattle_communication_pc.bnk
            inbattle_communication_npc.bnk
        yu_yin_bao2/
            voiceover.bnk
        abcABC123/
            yu yin bao3/
                voiceover.bnk
vo_很多的语音包信息.json
```

#### `json`文件内容

```json
[
    {
        "nickName": "语音包1",
        "bankPath": "yu yin bao1/voiceover.bnk"
    },
    {
        "nickName": "语音包2",
        "bankPath": "yu_yin_bao2/voiceover.bnk"
    },
    {
        "nickName": "语音包3",
        "bankPath": "abcABC123/yu yin bao3/voiceover.bnk"
    }
]
```

### 2.3 使用字幕的语音包文件示例：

将要创建的语音包文件：`voiceover_我的字幕语音包.wotmod`

#### 创建目录

```chatinput
res/
    audioww/
        my_voice_pack/
            vocieover.bnk
            inbattle_communication_pc.bnk
            inbattle_communication_npc.bnk
    mods/
        my_subtitles_resources/
            sentences/
            images/
            characters.json
            visuals.json
sbt_我的语音包信息.json
```

#### `json`文件内容

```json
{
    "nickName": "我的语音包01",
    "bankPath": "audioww/my_voice_pack/voiceover.bnk",
    "characters": "mods/my_subtitles_resources/characters.json",
    "sentences": "mods/my_subtitles_resources/sentences",
    "visuals": "mods/my_subtitles_resources/visuals.json"
}
```

#### 或者改为这样

```json
[
    {
        "nickName": "我的语音包01",
        "bankPath": "audioww/my_voice_pack/voiceover.bnk",
        "characters": "mods/my_subtitles_resources/characters.json",
        "sentences": "mods/my_subtitles_resources/sentences",
        "visuals": "mods/my_subtitles_resources/visuals.json"
    }
]
```

### 2.4 在使用字幕的语音包文件中添加多个语音包：

如果需要在一个语音包文件中**添加多个语音包**，参考前文提到的[方法](#22-在普通语音包文件中添加多个语音包)。

*注意：普通语音包与字幕语音包**不可以**在同一语音包文件中混在一起添加，
两个*`json`*文件仅能用于添加对应类型的语音包*

## 3、语音包的附加文件

这是一个可选项，插件为第三方来源的语音包提供了多种个性化功能：

- 一个`Wwise`事件在语音包被选中并切换后播放。
- 一张`png`图片在语音包被选中并切换后，展示在右侧。
- 一系列自定义通知信息在语音包被选中并切换后，发送至通知中心。
（该功能可以被关闭，关闭后，你依然可以通过点击右侧图片接收该消息）
- 提交重映射方案用于在语音包被选中并切换后，替换游戏中的任意声音。
（该功能可以被关闭，与`audio_mods.xml`的功能相似）
- 一个重映射声明的自定义消息在语音包选中并切换，单击对应按钮后，发送至通知中心
（动态重映射功能不可用或禁用时将不会发送）

### 3.1 添加特殊的`Wwise`事件：

在`Wwise`事件选项卡中创建名为`vo_selected`的事件，并将其关联声音播放容器即可。

你也可以通过设置[重映射方案](#34-添加重映射方案)来替换这个`Wwise`事件，这个事件在切换语音后总是播放。

### 3.2 添加`png`

将图片命名为`default.png`，并将其放入对应语音包`.bnk`所在的文件夹中即可。

示例：

```chatinput
res/
    audioww/
        my_voice_pack/
            default.png
            voiceover.bnk
```

### 3.3 添加自定义通知信息

提供两种方式保存自定义通知文本，分别是使用`msg.txt`或`msg.json`，
其中`msg.json`优先级最高。将其放入对应语音包`.bnk`所在的文件夹中即可。

你可以在[resources](../resources/template)目录中找到模板文件。

其中：

- `msg.txt`用于创建固定消息内容的无限迭代对象；
- `msg.json`用于创建包含多条消息内容的无限迭代对象。

每次播放选中语音时，都会进行判断是否进行通知，将通过无限迭代对象获取该语音包的下一条通知内容。

语音包在切换后，音频播放计数将归零，根据这个特性，将`vo_selected`事件关联一个顺序播放的音频容器，
使用`msg.json`按顺序添加自定义消息，你就能决定某一个声音播放时，接收到的消息的内容。

示例：

```chatinput
res/
    audioww/
        my_voice_pack/
            msg.txt 或者 msg.json
            voiceover.bnk
```

#### 使用`.txt`格式

```chatinput
#第一个非空格字符将成为一个占位符，这个示例中是“#”
↑这个字符将在读取时被舍弃。
```

输出的内容等同于：

```HTML
第一个非空格字符将成为一个占位符，这个示例中是“#”<br><br>↑这个字符将在读取时被舍弃。
```

这么做是为了防止`HTML`标签在使用`ResMgr`模块读取时被解析。

#### 使用`.json`格式

```json
[
    {
        "text": "用于循环的第一条文本内容"
    },
    {
        "text": "用于循环的第二条文本内容"
    }
]
```

#### 已知的、自定义消息支持的`HTML`标签

```html
<b>加粗</b>
<i>斜体</i>
<u>下划线</u>
<a href="event:CUSTOM_EVENT_OPEN_URL:https://www.worldoftanks.com/">超链接，将跳转至外部浏览器打开</a>
<font size="14">正文字体大小</font>
<font color="#cc9933" size="15">标题字体大小，使用金色</font>
<br>换行
```

换行回车符同样可以换行，它相当于两个换行标签。

*注意：不是所有的颜色都支持，个别颜色代码会导致空消息*

消息中心的超链接单击事件在《坦克世界》中不会被处理，因此添加了一个模块用于响应该事件，
使用超链接需要在链接前添加：`event:CUSTOM_EVENT_OPEN_URL:`

消息类型将固定为“GameGreeting”，左边会带有一个小信封

### 3.4 添加重映射方案：

提供两种方式添加重映射方案，分别是使用`audio_mods.xml`或者`remapping.json`，
其中`audio_mods.xml`优先级最高。将其放入对应语音包`.bnk`所在的文件夹中即可。

你可以在[resources](../resources/template)目录中找到模板文件。

示例：

```chatinput
res/
    audioww/
        my_voice_pack/
            audio_mods.xml 或 remapping.json
            voiceover.bnk
```

#### 使用`audio_mods.xml`

```xml
<audio_mods.xml>
	<loadBanks>
		<bank>
			<name/>
		</bank>
	</loadBanks>
	<events>
		<event>
			<!-- 在下面填入要替换的 Wwise 事件名 -->
			<name>lightbulb</name>
			<!-- 在下面填入你创建的 Wwise 事件名 -->
			<mod>lightbulb_mod</mod>
			<!-- 灯泡语音1将被更换 -->
		</event>
		<event>
			<name>lightbulb_02</name>
			<mod>lightbulb_02_mod</mod>
			<!-- 灯泡语音2将被替换 -->
		</event>
	</events>
</audio_mods.xml>
```

它的格式就是官方给出的`audio_mods.xml`所用格式，其中`<loadBanks>`属性会被忽视。

#### 使用`remapping.json`

```json
{
    "lightbulb": "lightbulb_mod",
    "lightbulb_02": "lightbulb_02_mod"
}
```

### 3.5 添加重映射声明消息

使用`remap_msg.txt`保存自定义通知文本，将其放入对应语音包`.bnk`所在的文件夹中即可。

你可以在[resources](../resources/template)目录中找到模板文件。

#### 使用`remap_msg.txt`

```chatinput
#第一个非空格字符将成为一个占位符，这个示例中是“#”
↑这个字符将在读取时被舍弃。
```

输出的内容等同于：

```HTML
第一个非空格字符将成为一个占位符，这个示例中是“#”<br><br>↑这个字符将在读取时被舍弃。
```

同样支持`HTML`标签，参考前文提到的[方法](#已知的自定义消息支持的html标签)。